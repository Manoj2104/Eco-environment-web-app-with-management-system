{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold"><i class="bi bi-calendar3 text-primary me-2"></i>Event Calendar</h4>
    <a href="{{ url_for('events.create') }}" class="btn btn-outline-success btn-sm rounded-pill shadow-sm">
      <i class="bi bi-plus-circle me-1"></i> Add Event
    </a>
  </div>

  <!-- Calendar Section -->
  <div id="calendar" class="mb-5 shadow rounded-4 p-3 bg-white"></div>

  <!-- Upcoming Events List -->
  <h5 class="fw-semibold mb-3"><i class="bi bi-clock text-secondary me-2"></i>Upcoming Events</h5>
  {% if upcoming_events %}
  <div class="row g-3">
    {% for event in upcoming_events %}
    <div class="col-md-6">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body">
          <h6 class="fw-bold mb-1">{{ event.title }}</h6>
          <p class="text-muted small mb-2">
            <i class="bi bi-calendar-event me-1"></i>{{ event.date.strftime('%b %d, %Y') }}
            <i class="bi bi-clock ms-3 me-1"></i>{{ event.time.strftime('%I:%M %p') }}
          </p>
          <p class="text-muted small mb-0"><i class="bi bi-geo-alt me-1"></i>{{ event.location }}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-light border text-muted">
    No upcoming events. Check back later!
  </div>
  {% endif %}
</div>

<!-- FullCalendar CDN -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 500,
      themeSystem: 'bootstrap5',
      events: [
        {% for event in upcoming_events %}
        {
          title: '{{ event.title }}',
          start: '{{ event.date.isoformat() }}',
          url: "{{ url_for('events.view_event', event_id=event.id) }}"
        },
        {% endfor %}
      ],
      eventClick: function(info) {
        info.jsEvent.preventDefault(); // prevent default browser navigation
        if (info.event.url) {
          window.location.href = info.event.url;
        }
      }
    });
    calendar.render();
  });
</script>

<style>
  #calendar {
    background: #f8f9fa;
    border-radius: 1rem;
  }
  .fc-toolbar-title {
    font-size: 1.25rem;
    font-weight: 600;
  }
</style>
{% endblock %}
