{% extends 'base.html' %}
{% block content %}
<section class="section py-5">
  <div class="container">
    <h3 class="fw-bold mb-4"><i class="bi bi-people-fill me-2 text-success"></i>See Volunteers</h3>

    <!-- Top Stats -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-primary text-white p-3">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">{{ volunteers|length }}</h5>
              <small>Total Volunteers</small>
            </div>
            <i class="bi bi-people-fill fs-2"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-success text-white p-3">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">
                {{ volunteers | selectattr("is_online") | list | length }}
              </h5>
              <small>Currently Online</small>
            </div>
            <i class="bi bi-wifi fs-2"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-warning text-dark p-3">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">
                {{ volunteers | sum(attribute='xp') }}
              </h5>
              <small>Total XP Earned</small>
            </div>
            <i class="bi bi-star-fill fs-2"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="mb-3">
      <input type="text" class="form-control" id="searchInput" placeholder="Search volunteers by name or email...">
    </div>

    <!-- Volunteer Cards -->
    <div class="row g-4" id="volunteerList">
      {% for volunteer in volunteers %}
      <div class="col-md-4 volunteer-card" data-name="{{ volunteer.name }}" data-email="{{ volunteer.email }}">
        <div class="card border-0 shadow-sm p-3">
          <div class="d-flex align-items-center mb-3">
            <img src="https://ui-avatars.com/api/?name={{ volunteer.name }}" class="rounded-circle me-3" width="60" height="60" alt="avatar">
            <div>
              <h6 class="mb-0">{{ volunteer.name }}</h6>
              <small class="text-muted">{{ volunteer.email }}</small><br>
              <small class="{{ 'text-success' if volunteer.is_online else 'text-muted' }}">
                <i class="bi {{ 'bi-circle-fill' if volunteer.is_online else 'bi-circle' }}"></i>
                {{ 'Online' if volunteer.is_online else 'Offline' }}
              </small>
            </div>
          </div>
          <div class="mb-2">
            <small class="text-muted">Joined: {{ volunteer.created_at.strftime('%d %b %Y') if volunteer.created_at else 'N/A' }}</small><br>
            <small class="text-muted">Location: 
              {% if volunteer.latitude and volunteer.longitude %}
                ({{ volunteer.latitude }}, {{ volunteer.longitude }})
              {% else %}
                Not shared
              {% endif %}
            </small>
          </div>
          <div class="mb-2">
            <span class="badge bg-success">XP: {{ volunteer.xp or 0 }}</span>
            {% if volunteer.badges %}
              {% for badge in volunteer.badges %}
                <span class="badge bg-primary">{{ badge.name }}</span>
              {% endfor %}
            {% else %}
              <span class="badge bg-secondary">No badges</span>
            {% endif %}
          </div>
          <a href="{{ url_for('dashboard.profile', user_id=volunteer.id) }}" class="btn btn-outline-success btn-sm mt-2 w-100">
            <i class="bi bi-person-lines-fill me-1"></i> View Profile
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<script>
  const searchInput = document.getElementById('searchInput');
  const cards = document.querySelectorAll('.volunteer-card');

  searchInput.addEventListener('input', () => {
    const term = searchInput.value.toLowerCase();
    cards.forEach(card => {
      const name = card.dataset.name.toLowerCase();
      const email = card.dataset.email.toLowerCase();
      card.style.display = (name.includes(term) || email.includes(term)) ? '' : 'none';
    });
  });
</script>
{% endblock %}
