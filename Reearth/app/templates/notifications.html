{% extends 'base.html' %}
{% block content %}
<section class="section py-5">
  <div class="container">
    <h3 class="mb-4">Notifications</h3>
    <button id="mark-all-read" class="btn btn-sm btn-outline-primary mb-3">
      <i class="bi bi-eye"></i> Mark All as Read
    </button>

    {% for notification in notifications %}
    <div class="card shadow-sm mb-3 notification" id="notification-{{ notification.id }}">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <i class="bi bi-geo-alt-fill text-primary"></i>
          <strong>{{ notification.title }}</strong>
          <p class="mb-0">{{ notification.message }}</p>
        </div>
        <div class="text-end">
          <span class="badge bg-secondary">{{ notification.timestamp.strftime('%b %d, %H:%M') }}</span>
          {% if not notification.read %}
          <span class="badge bg-danger">New</span>
          {% endif %}
          <i class="bi bi-check2-circle text-success ms-2 mark-read" title="Mark as Read" data-id="{{ notification.id }}" style="cursor:pointer;"></i>
          <i class="bi bi-trash text-danger ms-2 delete-notification" title="Delete" data-id="{{ notification.id }}" style="cursor:pointer;"></i>
        </div>
      </div>
    </div>
    {% else %}
    <p>No notifications yet.</p>
    {% endfor %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {

    // DELETE
    document.querySelectorAll('.delete-notification').forEach(btn => {
      btn.addEventListener('click', function () {
        const notificationId = this.dataset.id;
        fetch(`/notifications/delete/${notificationId}`, {
          method: 'DELETE'
        }).then(response => {
          if (response.ok) {
            const el = document.getElementById(`notification-${notificationId}`);
            if (el) el.remove();
          }
        });
      });
    });

    // MARK READ (single)
    document.querySelectorAll('.mark-read').forEach(btn => {
      btn.addEventListener('click', function () {
        const notificationId = this.dataset.id;
        fetch(`/notifications/mark_read/${notificationId}`, {
          method: 'POST'
        }).then(response => {
          if (response.ok) {
            const el = document.getElementById(`notification-${notificationId}`);
            if (el) el.classList.add('text-muted');
          }
        });
      });
    });

    // MARK ALL READ
    document.getElementById('mark-all-read')?.addEventListener('click', function () {
      fetch(`/notifications/mark_all_read`, {
        method: 'POST'
      }).then(response => {
        if (response.ok) {
          document.querySelectorAll('.notification').forEach(el => el.classList.add('text-muted'));
        }
      });
    });

  });
</script>
{% endblock %}
